#!/usr/bin/env bash

set -eu

target="$HOME/tmp/selfie.jpg"

preview_pidfile="$XDG_RUNTIME_DIR/selfie_preview.pid"
preview_cleanup() { rm -rf "$preview_pidfile"; }

preview() {
    echo $$ >"$preview_pidfile"
    trap preview_cleanup RETURN
    qiv -tiGfl --vikeys -T "$target"
}

fswebcam -q -r 5000x5000 "$target"

[[ -e $preview_pidfile ]] || { preview & }
