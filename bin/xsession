#!/bin/bash

set -e

# startx unsets DBUS_SESSION_BUS_ADDRESS, let's set it back
export DBUS_SESSION_BUS_ADDRESS="unix:path=$XDG_RUNTIME_DIR/bus"

if [ -d /etc/X11/xinit/xinitrc.d ]; then
    for i in /etc/X11/xinit/xinitrc.d/* ; do
        [ -f "$i" ] && . "$i"
    done
fi

xresources=~/.Xresources
if [ -e "$xresources" ]; then
    xrdb -load "$xresources"
fi

xmodmap=~/.Xmodmap
if [ -e "$xmodmap" ]; then
    xmodmap "$xmodmap"
fi

xkb
xscreen
audio pulse_init

if [ "$(xserverq name)" = 'Xorg.bin' ]; then
    :
    #compton
fi

# ----------------------------------------

_main() {
    osdd &
    dunst &
    workrave &
    _xmonad
}

# ----------------------------------------

_herbstluftwm() {
    herbstluftwm --locked
}

_openbox() {
    tint2 &
    openbox
}

_xmonad() {
    tray &
    xmonad
}

session=$1
case $session in
    main | \
    herbstluftwm | openbox | xmonad)
        export XSESSION="$session"
        _$session
        ;;
    *)
        [ $# -gt 0 ] && "$@"
        ;;
esac
