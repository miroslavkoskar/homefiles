#!/usr/bin/env bash

set -eu

target=$TMPDIR/cam-hook.jpg

preview_pidfile=$XDG_RUNTIME_DIR/cam-hook_preview.pid
preview_cleanup() { rm -f "$preview_pidfile"; }

preview() (
    echo $$ >"$preview_pidfile"
    trap preview_cleanup EXIT
    qiv -tiGfl --vikeys -T "$target"
)

case $ACTION in
    init)
        ;;
    start)
        ;;
    download)
        cp -- "$ARGUMENT" "$target"
        [[ -e $preview_pidfile ]] || preview &
        ;;
    stop)
        ;;
esac
