#!/usr/bin/env bash

set -eu

prgname=${0##*/}

if (( ! $# )); then
    echo "usage: $prgname cmd [arg]..." >&2
    exit 2
fi

if [[ $prgname = 'xrun' ]] && xpgrep "$1" >/dev/null; then
    xkillall "$1"
    sleep 1
fi

if ! xpgrep "$1" >/dev/null; then
    pid=$$
    pgid=$(ps --pid "$pid" -o pgid=)
    [[ $pid = "$pgid" ]] && exec "$@" || exec setsid "$@"
fi
