#!/usr/bin/env bash

set -eu -o pipefail

prgname=${0##*/}

_usage() {
    echo "usage: $prgname [-f] pattern"
}
usage() { _usage; exit 0; }
usage_err() { _usage; exit 2; } >&2

declare -i fopt=
while getopts 'fh' opt; do
    case $opt in
        f)
            fopt=1
            ;;
        h)
            usage
            ;;
        *)
            usage_err
            ;;
    esac
done
shift $((OPTIND-1))

(( ! $# )) && usage_err

xpgrep_args=()
(( $fopt )) && xpgrep_args+=(-f)
xpgrep_args+=(-- "$1")

xpgrep "${xpgrep_args[@]}" | xargs -r killer -g
