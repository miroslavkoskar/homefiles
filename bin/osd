#!/usr/bin/env bash

set -eu

prgname=${0##*/}

name='default'
dispno=$(xserverq dispno)
pipe="$TMPDIR/osd-$UID/$name$dispno"

if [[ $prgname = 'osdd' ]]; then
    [[ -e $pipe ]] && exit 3

    mkdir -p -m 700 "${pipe%/*}"
    mkfifo -m 600 "$pipe"

    cleanup() {
        rm -f "$pipe"
        kill 0
    }
    trap cleanup EXIT

    aosd_cat -O 0 -p 2 -x -10 -y 25 -e 0 -d 5 \
             -t 2 -n local_osd -A 2 -b 215 \
             -B black -R yellow \
             -f 0 -u 1000 -o 0 \
             -l 1 \
             -k -m -i "$pipe"
    exit
fi

[[ ! -p $pipe ]] && exit 1
echo "$*" >"$pipe"
