#!/usr/bin/env bash

set -eu
shopt -s extglob

prgname=${0##*/}

[[ -t 1 ]] || exec >/dev/null
exec 2>/dev/null

cleanup() {
    local retstat=$?
    if (( retstat )); then
        notify "___ $prgname FAIL ___"
    fi
}
trap cleanup EXIT

src=${1:-$(xclip -o | head -c 255)}
case $src in
    http://tvcatchup.com/* | \
    http://www.rtvs.sk/* | \
    http://www.ustream.tv/* \
        )
        printf -v title '%q' "$src"
        streamlink \
            --loglevel=error \
            --player-args="--title=$title --force-media-title=$title -- {filename}" \
            -- "$src"
        exit
        ;;
esac

[[ -t 1 ]] || exec >/dev/null 2>&1
mpv --force-window=immediate -- "$src"
