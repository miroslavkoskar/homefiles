#!/usr/bin/env bash

set -eu -o pipefail

prgname=${0##*/}

declare -i blue=0
[[ $prgname = 'playctl-bluetooth' ]] && blue=1

bluectl() {
    # hack which happens to workaround bluetooth-player input issues
    (sleep 0.01; echo "$1"; sleep 0.01) | bluetooth-player 2>/dev/null
}

play_pause_blue() {
    local status
    status=$(bluectl show | awk '/Status:/ {print $2}')
    case $status in
        playing)
            bluectl pause >/dev/null
            ;;
        *)
            bluectl play >/dev/null
            ;;
    esac
}

case ${1-} in
    play-pause)
        (( blue )) && play_pause_blue || playerctl play-pause
        ;;
esac
