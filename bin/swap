#!/usr/bin/env bash

set -eu

prgname=${0##*/}

if (( $# < 2 )); then
    echo "usage: $prgname a b" >&2
    exit 2
fi

a=$(realpath -se -- "$1")
b=$(realpath -se -- "$2")

para=${a##*/}
if [[ ! -w $para ]]; then
    echo "$prgname: $para: Write permission is not granted" >&2
    exit 1
fi

parb=${b##*/}
if [[ ! -w $parb ]]; then
    echo "$prgname: $parb: Write permission is not granted" >&2
    exit 1
fi

tmp="$b.swap$(date +%s)"
mv -nT "$b" "$tmp"
mv -nT "$a" "$b"
mv -nT "$tmp" "$a"
