#!/usr/bin/env bash
#
# Scrolls through arguments or stdin lines if none arguments were passed.
# Current item is printed in the status line on stderr and send to stdout
# for further processing.
#
# Navigation:
#
# * q / Q       - quit
# * g / 0       - beginning
# * G / $       - end
# * k / K       - previous
# * (default)   - next
#
# :Copyright: (c) 2013 Miroslav Koskar (http://mkoskar.com/)
# :License: BSD 2-Clause

set -eu

if (( $# )); then
    items=("$@")
else
    readarray -t items
fi

exec </dev/tty

len=${#items[@]}
i=0

while true; do
    (( len > 0 )) || break
    item=${items[i]}

    printf '\e[1G%s\e[0K' "$((i+1)) : $item" >&2
    printf '%s\n' "$item"

    (( len > 1 )) || break
    read -N1 -rs c
    case $c in
        q|Q)
            break
            ;;
        g|0)
            i=0
            ;;
        G|$)
            i=$((len-1))
            ;;
        k|K)
            i=$((i-1))
            ;;
        *)
            i=$((i+1))
            ;;
    esac
    (( i < 0 )) && i=$((len-1))
    (( i > len-1 )) && i=0
done
echo >&2
