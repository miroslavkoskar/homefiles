#!/usr/bin/env bash

set -eu -o pipefail

prgname=${0##*/}

# http://checkip.amazonaws.com/
# https://api.ipify.org/
# https://ip.anysrc.net/banner
# https://ip.anysrc.net/json
# https://wtfismyip.com/json

if [[ $prgname = 'ipinfo-tor' ]]; then
    if (( ! $# )); then
        echo "usage: $prgname hostname" >&2
        exit 2
    fi
    resolve() { tor-resolve "$@" 2>/dev/null; }
fi

if (( $# )); then
    ip=$(resolve "$1")
    torify curl -sL "http://ip-api.com/json/$ip" | jshon
else
    curl -sL 'http://ip-api.com/json' | jshon
fi
