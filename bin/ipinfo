#!/usr/bin/env bash

set -eu -o pipefail

prgname=${0##*/}

# http://checkip.amazonaws.com/
# http://ipinfo.io/
# https://api.ipify.org/
# https://ip.anysrc.net/banner
# https://ip.anysrc.net/json
# https://wtfismyip.com/json

if [[ $prgname = 'ipinfo-tor' ]]; then
    if (( ! $# )); then
        echo "usage: $prgname hostname" >&2
        exit 2
    fi
    resolve() { tor-resolve "$@" 2>/dev/null; }
fi

if (( $# )); then
    ip=$(resolve "$1")
    torify curl -sSL "http://ipinfo.io/$ip" | jshon -QC
else
    curl -sSL 'http://ipinfo.io/' | jshon -QC
fi
