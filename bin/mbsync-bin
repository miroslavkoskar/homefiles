#!/usr/bin/env bash

set -eu

(( $# )) || exit 2

name=$1
ts_begin=$(date +%s)

cleanup() {
    local retstat=$?
    local ts_end; ts_end=$(date +%s)
    echo "exiting after $(((ts_end-ts_begin)/60)) minutes, $(((ts_end-ts_begin)%60)) seconds ($retstat)"
    if (( retstat )); then
        notify -u critical "mbsync $name"
    fi
}
trap cleanup EXIT

/usr/bin/mbsync -q -c ~/.config/mbsyncrc "$1"
