#!/bin/bash

set -eu

[ $# -eq 0 ] && exit 2

name=$1
t_begin=$(date +%s)
prgname="mbsync($name)"

cleanup() {
    local exitstatus=$?
    local t_end=$(date +%s)
    echo "exiting after $(((t_end-t_begin)/60)) minutes, $(((t_end-t_begin)%60)) seconds ($exitstatus)"
    if [ $exitstatus -eq 0 ]; then
        notify "___ $prgname ___"
    else
        notify "___ $prgname FAIL ___"
    fi
}
trap cleanup EXIT

/usr/bin/mbsync -q "$1"
