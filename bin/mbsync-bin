#!/usr/bin/env bash

set -eu

(( $# )) || exit 2

name=$1
t_begin=$(date +%s)
prgname="mbsync($name)"

cleanup() {
    local retstat=$?
    local t_end; t_end=$(date +%s)
    echo "exiting after $(((t_end-t_begin)/60)) minutes, $(((t_end-t_begin)%60)) seconds ($retstat)"
    if (( $retstat == 0 )); then
        notify "___ $prgname ___"
    else
        notify "___ $prgname FAIL ___"
    fi
}
trap cleanup EXIT

/usr/bin/mbsync -q "$1"
