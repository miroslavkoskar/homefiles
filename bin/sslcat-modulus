#!/usr/bin/env bash

set -eu -o pipefail

prgname=${0##*/}

_usage() {
    echo "usage: $prgname {dsa | ec | req | rsa | x509} filename"
}
usage() { _usage; exit 0; }
usage_err() { _usage; exit 2; } >&2

while getopts h opt; do
    case $opt in
        h) usage ;;
        *) usage_err ;;
    esac
done
shift $((OPTIND-1))

(( $# != 2 )) && usage_err

# ----------------------------------------

case $1 in dsa | ec | rsa | x509 | req) ;; *) usage_err ;; esac

[[ -e $2 ]] || usage_err

openssl "$1" -modulus -noout -in "$2" | sha1sum
