#!/usr/bin/env bash

set -eu

prgname=${0##*/}

playback_up() {
    amixer -q set Master 5%+
}

playback_down() {
    amixer -q set Master 5%-
}

playback_toggle() {
    amixer -q set Master toggle
}

playback_dock_toggle() {
    amixer -q -c 0 set Headphone,1 toggle
}

capture_toggle() {
    amixer -q set Capture toggle
}

case ${1-} in
    playback_up | playback_down | \
    playback_toggle | playback_dock_toggle | \
    capture_toggle)
        $1
        status-osd audio
        exit
        ;;
    '')
        ;;
    *)
        echo "usage: $prgname [playback_up | playback_down | playback_toggle | playback_dock_toggle | capture_toggle]" >&2
        exit 2
        ;;
esac

while true; do
    stat=$(status audio)
    printf '\e[1G%s\e[0K' "$stat"

    read -N1 -rs c
    case $c in
        [kK])
            playback_up
            ;;
        [jJ])
            playback_down
            ;;
        [mM])
            playback_toggle
            ;;
        [nN])
            playback_dock_toggle
            ;;
        [rR])
            capture_toggle
            ;;
        *)
            break
            ;;
    esac
done
echo
