#!/bin/bash

set -e

err_usage() {
    echo "usage: $(basename "$0") [-g | -s sigspec] pid ..."
    exit 1
}

while getopts 'gs:' opt; do
    case "$opt" in
        g)
            gopt=1
            ;;
        s)
            sopt="$OPTARG"
            ;;
        *)
            err_usage
    esac
done
shift $((OPTIND-1))

[ $# -eq 0 ] && err_usage

sig="${sopt:-SIGTERM}"

if [ -n "$gopt" ]; then
    for pid in "$@"; do
        pgid="$(ps -p "$pid" -o pgid=)"
        [ -z "$pgid" ] && continue

        pkill --signal "$sig" -g "$pgid"
    done
else
    kill -s "$sig" "$@"
fi
