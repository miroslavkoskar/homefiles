#!/bin/bash

set -e

_usage() {
    echo "usage: $(basename "$0") [-g] [-s sigspec] pid..."
}
usage() { _usage; exit 0; }
usage_err() { _usage >&2; exit 2; }

while getopts 'gs:h' opt; do
    case $opt in
        g)
            gopt=1
            ;;
        s)
            sopt=$OPTARG
            ;;
        h)
            usage
            ;;
        *)
            usage_err
            ;;
    esac
done
shift $((OPTIND-1))

[ $# -eq 0 ] && usage_err

sig=${sopt:-SIGTERM}

if [ -n "$gopt" ]; then
    for pid in "$@"; do
        pgid=$(ps --pid "$pid" -o pgid=) && kill -s "$sig" -"${pgid##* }"
    done
else
    kill -s "$sig" "$@"
fi
