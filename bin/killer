#!/usr/bin/env bash

set -eu

prgname=${0##*/}

_usage() {
    echo "usage: $prgname [-g] [-s sigspec] pid..."
}
usage() { _usage; exit 0; }
usage_err() { _usage; exit 2; } >&2

declare -i gopt=
while getopts 'gs:h' opt; do
    case $opt in
        g)
            gopt=1
            ;;
        s)
            sopt=$OPTARG
            ;;
        h)
            usage
            ;;
        *)
            usage_err
            ;;
    esac
done
shift $((OPTIND-1))

(( $# )) || usage_err

sig=${sopt:-SIGTERM}

if (( gopt )); then
    for pid in "$@"; do
        pgid=$(ps --pid "$pid" -o pgid=) && kill -s "$sig" -"${pgid##* }"
    done
else
    kill -s "$sig" "$@"
fi
