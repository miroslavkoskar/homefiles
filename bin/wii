#!/usr/bin/env bash

set -eu -o pipefail

ti_reset=$'\e[m'
ti_hi0=$'\e[1;37m'
ti_hi1=$'\e[1;32m'
ti_hi2=$'\e[1;31m'
ti_hi3=$'\e[1;33m'

format="%I, %j (%l, %L) at %a
----------------------------------------
Condition:              ${ti_hi0}%c${ti_reset}
Clouds:                 ${ti_hi0}%d%%${ti_reset}
Barometric pressure:    %bhPa
Precipitation:          %pmm
Relative humidity:      ${ti_hi0}%P%%${ti_reset}
Temperature:            Low: ${ti_hi1}%h째C${ti_reset} / High: ${ti_hi2}%H째C${ti_reset} / Current: ${ti_hi3}%t째C${ti_reset}
Wind:                   %X (%x째), %wmps, %Wmps
Sun:                    %s / %S
"

get() {
    local opts opts_digest cache
    opts=(-m -l "$1")
    read -ra opts_digest < <(printf '%s\n' "${opts[@]}" | md5sum)
    cache="$HOME/.cache/shaman-${opts_digest: -7}.json"
    [[ -e $cache ]] || touch "$cache"
    shaman "${opts[@]}" -f "$format" -c "$cache"
}

echo

get 'Bratislava,SK'
get 'Poprad,SK'
get 'Zilina,SK'

get 'Berlin,DE'
get 'London,GB'
get 'Prague,CZ'
