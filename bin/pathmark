#!/bin/bash

set -e

if [ $# -eq 0 ]; then
    echo "usage: $(basename "$0") path" >&2
    exit 2
fi

exec 2>/dev/null

path=$(realpath "$1")
basename=$(basename "$path")

echo "$path"

# TODO: use $ man -f instead?

if manp=$(man -w "$path") && \
    [ "$manp" != "$path" ]; then
    man "$path" | sed -nr '/^NAME/{n;s/^\s*//p}'
else
    if manp=$(man -w "$basename") && \
        [ "$manp" != "$basename" ]; then
        man "$basename" | sed -nr '/^NAME/{n;s/^\s*//p}'
    fi
fi

for pkg in $(pacman -Qoq "$path"); do
    pkgmark "$pkg" | sed -nr '1s/^/pkg: /p'
done
