#!/usr/bin/env bash
#
# Wrapper script to use Vim as a pager.
# Install by running ``export PAGER='pg'``.
#
# :Copyright: (c) 2013 Miroslav Koskar (http://mkoskar.com/)
# :License: BSD 2-Clause

set -eu

prgname=${0##*/}

if [[ ! -t 1 ]]; then
    cat
    exit
fi

run() {
    if [[ $prgname = 'pg0' ]]; then
        set -- -c 'syntax off | filetype off | filetype plugin off' "$@"
    else
        set -- "$@" -c 'AnsiEsc'
    fi
    if [[ $PAGER_TITLE ]]; then
        vim -NO -u ~/.vim/vimrc_pg "$@" -c "redraw | file ${PAGER_TITLE//\ /\\ }"
    else
        vim -NO -u ~/.vim/vimrc_pg "$@"
    fi
}

if [[ -t 0 ]]; then
    run "$@"
    exit
fi

PAGER_TITLE=${PAGER_TITLE:--stdin-}
exec 8<&0 0<&1
run -c 'silent e /dev/fd/8' "$@"
