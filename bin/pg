#!/bin/bash
#
# Wrapper script to use Vim as a pager.
# Install by running `export PAGER='pg'`.
#
# :Copyright: (c) 2013 Miroslav Koskar (http://miroslavkoskar.com/)
# :License: BSD 2-Clause

set -e

if [ ! -t 1 ]; then
    echo 'stdout is not a tty' >&2
    exit 1
fi

run() {
    if [ "$(basename "$0")" = 'pgx' ]; then
        set -- -c 'syntax off | filetype off | filetype plugin off' "$@"
    else
        set -- "$@" -c 'AnsiEsc'
    fi
    if [ -n "$PAGER_TITLE" ]; then
        vim -NOn -u ~/.pgrc "$@" -c "redraw | file ${PAGER_TITLE//\ /\\ }"
    else
        vim -NOn -u ~/.pgrc "$@"
    fi
}

if [ -t 0 ]; then
    run "$@"
    exit
fi

PAGER_TITLE="${PAGER_TITLE:--stdin-}"
exec 10<&0 0<&1
run -c 'silent e /dev/fd/10' "$@"
