#!/bin/bash
#
# Is device mounted on mountpoint of some type with a specific mount option?
#
# :Copyright: (c) 2014 Miroslav Koskar (http://miroslavkoskar.com/)
# :License: BSD 2-Clause

set -e

if [ $# -eq 0 ]; then
    echo "usage: $(basename "$0") mountpoint [device] [type] [option]"
    exit 2
fi

_mountpoint=$(realpath "$1")
_device=${2:-.*}
_type=${3:-.*}
_option=${4:-.*}

mount | awk -v mountpoint="$_mountpoint" \
            -v device="$_device" \
            -v type="$_type" \
            -v option="$_option" \
            '$0 ~ "^" device " on " mountpoint " type " type " .*[(,]" option "[,)].*$" {print $0; f=1} END {exit !f}'
