#!/usr/bin/env bash

set -eu

prgname=${0##*/}

_usage() {
    echo "usage: $prgname [-n name] [cmd] [arg]..."
}
usage() { _usage; exit 0; }
usage_err() { _usage; exit 2; } >&2

while getopts n:h opt; do
    case $opt in
        n) name=$OPTARG ;;
        h) usage ;;
        *) usage_err ;;
    esac
done
shift $((OPTIND-1))

(( $# )) || set -- shell

# ----------------------------------------

bin=${TERMBIN:-urxvtc}
name=${name:-term}

case $bin in
    mlterm)
        exec "$bin" -N "$name" -e "$@"
        ;;
    st)
        exec "$bin" -n "$name" -e "$@"
        ;;
    termite)
        cmd=$(shell-escape "$@")
        exec "$bin" --name "$name" -e "$cmd"
        ;;
    urxvt | urxvtc)
        exec "$bin" -name "$name" -e "$@"
        ;;
    xterm)
        exec "$bin" -name "$name" -e "$@"
        ;;
    *)
        exit 2
        ;;
esac
