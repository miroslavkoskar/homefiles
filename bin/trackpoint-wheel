#!/usr/bin/env bash

set -eu -o pipefail

prgname=${0##*/}

export LC_ALL=C

name='pointer:TPPS/2 IBM TrackPoint'
prop='libinput Button Scrolling Button'

state() {
    declare -i val=0
    val=$(xinput list-props "$name" | awk -F: "/^\s*$prop \(.*\):/ {print \$2}")
    echo $((val == 2))
}

if [[ $prgname = 'trackpoint-wheel-toggle' ]]; then
    case $(state) in 1) set -- 0 ;; *) set -- 1 ;; esac
fi

case ${1-} in
    1 | on | true)
        valset=2
        ;;
    0 | off | false)
        valset=0
        ;;
    '')
        state
        exit
        ;;
    *)
        echo "usage: $prgname [1 | on | true | 0 | off | false]" >&2
        exit 2
        ;;
esac

xinput set-prop "$name" "$prop" "$valset"
status-osd trackpoint_wheel
