#!/usr/bin/env bash

set -eu -o pipefail

newdirs=(~/mail/*/INBOX/new/)
declare -i prevnew=0

out() {
    local new; new=$(find "${newdirs[@]}" -type f | wc -l)
    if (( new > 0 )); then
        printf '<fc=#55FF55>%d</fc>' "$new"
        delta=$((new-prevnew))
        (( delta > 0 )) && printf '<fc=#FEED6A>(+%d)</fc>' $delta
    fi
    echo
    prevnew=$new
}

while true; do
    out
    inotifywait -qq -e create,delete,move "${newdirs[@]}"
    sleep 5
done
