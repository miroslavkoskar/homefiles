#!/bin/bash

set -e

tmp="${TMPDIR:-/tmp}/pacman-disowned-$UID-$$"
mkdir "$tmp"
trap 'rm -rf "$tmp"' EXIT

cd /etc
git ls-files | sed 's,^,/etc/,' | sort >"$tmp/ignore"

cd "$tmp"
pacman -Qlq | sort -u >db

find /etc /opt /usr \
    -type d \( \
        -name lost+found -o \
        -path /etc/.attic -o \
        -path /etc/.git -o \
        -path /etc/ssl/certs -o \
        -path /usr/share/mime \
    \) -prune -o \( -type d -printf '%p/\n' -o -print \) | sort >fs

comm -23 fs db >out
comm -23 out ignore
