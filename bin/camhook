#!/usr/bin/env bash

set -eu

target="$TMPDIR/camhook.jpg"

preview_pidfile="$XDG_RUNTIME_DIR/camhook_preview.pid"
preview_cleanup() { rm -rf "$preview_pidfile"; }

preview() {
    echo $$ >"$preview_pidfile"
    trap preview_cleanup RETURN
    qiv -tiGfl --vikeys -T "$target"
}

case $ACTION in
    init)
        ;;
    start)
        ;;
    download)
        cp -- "$ARGUMENT" "$target"
        [[ -e $preview_pidfile ]] || { preview & }
        ;;
    stop)
        ;;
esac
