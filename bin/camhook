#!/bin/bash

set -e

target=~/tmp/camhook.jpg
pidfile="$XDG_RUNTIME_DIR/camhook.pid"

preview() {
    echo $$ >"$pidfile"
    trap 'rm -f "$pidfile" "$target"' RETURN
    qiv -tiGfl --vikeys -T "$target"
}

case $ACTION in
    init)
        ;;
    start)
        ;;
    download)
        cp "$ARGUMENT" "$target"
        [ -e "$pidfile" ] || preview &
        ;;
    stop)
        ;;
esac
