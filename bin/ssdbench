#!/bin/bash

set -e

cd ~
out=benchfile

echo '--- hdparm ----------'

sudo hdparm -Tt /dev/sda

echo $'\n--- write ----------'

for i in {1..5}; do
    sudo bash -c 'echo 3 >/proc/sys/vm/drop_caches'
    dd if=/dev/zero of="$out" bs=1M count=1024 conv=fdatasync,notrunc
done

echo $'\n--- read ----------'

for i in {1..5}; do
    sudo bash -c 'echo 3 >/proc/sys/vm/drop_caches'
    dd if="$out" of=/dev/null bs=1M count=1024
done

rm "$out"
