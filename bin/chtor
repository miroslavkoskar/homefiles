#!/usr/bin/env bash

set -eu

prgname=${0##*/}

_usage() {
    echo "usage: $prgname [-p profile] [arg]..."
}
usage() { _usage; exit 0; }
usage_err() { _usage; exit 2; } >&2

profile=
while getopts 'p:h' opt; do
    case $opt in
        p)
            profile=$OPTARG
            ;;
        h)
            usage
            ;;
        *)
            usage_err
            ;;
    esac
done
shift $((OPTIND-1))

exec chp -p "${profile:-proxy-tor}" -- \
    --proxy-server='socks://127.0.0.1:9050' \
    --proxy-bypass-list='<local>' \
    --host-resolver-rules='MAP * ~NOTFOUND, EXCLUDE 127.0.0.1, EXCLUDE ::1, EXCLUDE localhost' \
    --incognito \
    "$@"
