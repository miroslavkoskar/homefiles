#!/bin/bash
#
# from-primary)
#   - synchronize content from PRIMARY to CLIPBOARD
#
# from-stdin)
#   - read stdin into PRIMARY and CLIPBOARD
#
# *)
#   - choose item from history (or take content of CLIPBOARD)
#     and host it in PRIMARY and CLIPBOARD
#   - echo it on stdout if it is not a terminal

set -e

case $1 in
    from-primary)
        xclip -o | xclip -i -selection clipboard
        ;;
    from-stdin)
        xclip -i -f | xclip -i -selection clipboard
        ;;
    *)
        [ ! -t 1 ] && filter=(-f)
        xclip -o -selection clipboard | xclip -i "${filter[@]}"
        ;;
esac

exit 0

# TODO: xcmenu is broken (namely it's synchronization feature)

xcmenu --query

case $1 in
    from-primary)
        data=$(xcmenu -p)
        xcmenu -ci <<<"$data"
        ;;
    from-stdin)
        data=$(</dev/stdin)
        xcmenu -ci <<<"$data"
        ;;
    *)
        id=$(xcmenu -m | dmenu xcmenu | sed 's/^[^0-9]*\([^:]*\):.*/\1/g')
        [ -z "$id" ] && exit 1

        data=$(xcmenu -g <<<"$id")
        xcmenu -ci <<<"$data"

        if [ ! -t 1 ]; then
            echo "$data"
        fi
        ;;
esac
