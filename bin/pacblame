#!/bin/bash

set -e

prgname=$(basename "$0")

_usage() {
    cat <<-EOF
	usage: $prgname         - blame by "install size"
	       $prgname -d      - blame by "depends on"
	       $prgname -r      - blame by "required by"
	EOF
}
usage() { _usage; exit 0; }
usage_err() { _usage >&2; exit 2; }

cmd="expac -H M -l '\n' '%m %n' | sort -k1nr"

while getopts 'drh' opt; do
    case $opt in
        d)
            cmd="expac -l ' ' '%n %E' | awk '{print NF - 1, \$1}' | sort -k1nr"
            ;;
        r)
            cmd="expac -l ' ' '%n %N' | awk '{print NF - 1, \$1}' | sort -k1nr"
            ;;
        h)
            usage
            ;;
        *)
            usage_err
            ;;
    esac
done
shift $((OPTIND-1))

if [ -t 1 ]; then
    export PAGER_TITLE=$(basename "$0")
    exec pgx sh -c "$cmd"
fi

eval "$cmd"
