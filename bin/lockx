#!/bin/bash

set -e

export PATH="/home/mirci/bin:$PATH"

USER='mirci'
XTTY=1

VTOLD=$(fgconsole)

SYSRQ_PATH='/proc/sys/kernel/sysrq'
SYSRQ_OLD=$(cat "$SYSRQ_PATH")
echo 0 > "$SYSRQ_PATH"

function cleanup {
    vtswitch-lock -u
    chvt $VTOLD
    echo $SYSRQ_OLD > "$SYSRQ_PATH"
}
trap cleanup EXIT

chvt $XTTY
vtswitch-lock

sudo -u $USER bash -c 'export DISPLAY=:0
                       export XAUTHORITY=~/.Xauthority
                       slock'
