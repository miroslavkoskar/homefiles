#!/usr/bin/env bash

set -eu

name=${1:-custom}
repo_dir="$HOME/packages/$name"
repo_db="$name.db"
repo_dbgz="$name.db.tar.gz"

mkdir -p "$repo_dir"
cd "$repo_dir"

# ----------------------------------------

rm -rf "$repo_db"*

if [[ ! -e $repo_db ]]; then
    pacrepo-init "$name"
fi

#tar -tzf "$repo_dbgz" | sed -n 's,^(.*)-.*-.*/$,\1,p' | sort -u >list.old
#ls *.pkg.tar.xz | sed -n 's,^(.*)-.*-.*-.*$,\1,p' | sort -u >list.curr

for i in *.pkg.tar.xz; do
    repo-add -n -q "$repo_dbgz" "$i"
done

#while read -r i; do
#    echo "==> $i removed"
#    repo-remove -q "$repo_dbgz" "$i"
#done < <(comm -23 list.old list.curr)
