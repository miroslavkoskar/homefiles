#!/usr/bin/env bash

set -eu

name=${1:-custom}
repo_dir="$HOME/packages/$name"
repo_db="$name.db"
repo_dbgz="$name.db.tar.gz"

mkdir -p "$repo_dir"
cd "$repo_dir"

if type repose &>/dev/null; then
    repose -fz "$name"
    exit
fi

rm -rf "$repo_db"*

for pkg in ./*.pkg.tar.xz; do
    repo-add -n -q "$repo_dbgz" "$pkg"
done
