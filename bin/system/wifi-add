#!/usr/bin/env bash

set -eu -o pipefail

if (( $EUID )); then
    echo 'This script must be run with root privileges.' >&2
    exit 1
fi

prgname=${0##*/}

if (( ! $# )); then
    echo "usage: $prgname ssid" >&2
    exit 2
fi

psk=$(wpa_passphrase "$1" |
    sed -n '/^network={/,${/^\s*#/d;s/\t/    /g;p}') &&
    printf '\n%s\n' "$psk" >>/etc/wpa_supplicant/wpa_supplicant.conf
