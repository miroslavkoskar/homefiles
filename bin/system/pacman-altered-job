#!/usr/bin/env bash

set -eu -o pipefail

loghome='/var/log/local'
mkdir -p "$loghome"
cd "$loghome"

# ----------------------------------------

logbase='pacman-altered'
log="$logbase.$(date '+%Y-%m-%d.%s')"
pacman-altered >"$log" 2>"_$log"

# ----------------------------------------

last2=($(ls "$logbase"* | tail -n2))
if (( ${#last2[@]} == 2 )); then
    diff -U 0 "${last2[@]}" | filterdiff --remove-timestamps
fi
