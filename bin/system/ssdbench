#!/usr/bin/env bash

set -eu

if (( EUID )); then
    echo 'This script must be run with root privileges.' >&2
    exit 1
fi

cd ~
out='benchfile'

echo '--- hdparm ----------'

hdparm -Tt /dev/sda

echo $'\n--- write ----------'

for ((i=0; i<5; i++)) do
    echo 3 >/proc/sys/vm/drop_caches
    dd if=/dev/zero of="$out" bs=1M count=1024 conv=fdatasync,notrunc
done

echo $'\n--- read ----------'

for ((i=0; i<5; i++)) do
    echo 3 >/proc/sys/vm/drop_caches
    dd if="$out" of=/dev/null bs=1M count=1024
done

rm -- "$out"
