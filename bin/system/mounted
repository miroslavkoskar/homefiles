#!/usr/bin/env bash
#
# Is device mounted on mountpoint of some type with a specific mount option?
#
# :Copyright: (c) 2014 Miroslav Koskar <http://mkoskar.com/>
# :License: BSD 2-Clause

set -eu

prgname=${0##*/}

_usage() {
    echo "usage: $prgname mountpoint [device] [type] [option]"
}
usage() { _usage; exit 0; }
usage_err() { _usage; exit 2; } >&2

while getopts 'h' opt; do
    case $opt in
        h)
            usage
            ;;
        *)
            usage_err
            ;;
    esac
done
shift $((OPTIND-1))

(( $# )) || usage_err

# ----------------------------------------

_mountpoint=$(realpath -- "$1")
_device=${2:-.*}
_type=${3:-.*}
_option=${4:-.*}

mount | awk -v mountpoint="$_mountpoint" \
            -v device="$_device" \
            -v type="$_type" \
            -v option="$_option" \
            '$0 ~ "^" device " on " mountpoint " type " type " .*[(,]" option "[,)].*$" {print $0; f = 1} END {exit !f}'
