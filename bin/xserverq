#!/bin/bash
#
# Get information about X server (based on DISPLAY environment variable).
#
# :Copyright: (c) 2013 Miroslav Koskar (http://miroslavkoskar.com/)
# :License: BSD 2-Clause

set -e

xserver_dispno() {
    ! xset q &>/dev/null && exit 1
    dispno="$(echo "$DISPLAY" | awk -F '[:.]' '{print $2}')"
    printf '%d\n' "$dispno"
}

xserver_pid() {
    dispno="$(xserver_dispno)"
    lockfile="/tmp/.X$dispno-lock"

    [ ! -f "$lockfile" ] && exit 1
    cat "$lockfile" | sed 's/\s//g'
}

xserver_cmd() {
    pid="$(xserver_pid)"
    ps -p "$pid" -o cmd=
}

xserver_name() {
    pid="$(xserver_pid)"
    ps -p "$pid" -o comm=
}

case "$1" in
    cmd)
        xserver_cmd
        ;;
    dispno)
        xserver_dispno
        ;;
    name)
        xserver_name
        ;;
    pid)
        xserver_pid
        ;;
    *)
        cat <<-EOF
		usage: xserverq cmd     - get command-line
		       xserverq dispno  - get display number
		       xserverq name    - get command name
		       xserverq pid     - get PID
		
		Get information about X server (based on DISPLAY environment variable).
		EOF
        exit 2
esac
