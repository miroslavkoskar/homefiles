#!/bin/bash
#
# Get information about X server (based on DISPLAY environment variable).
#
# :Copyright: (c) 2013 Miroslav Koskar (http://mkoskar.com/)
# :License: BSD 2-Clause

set -e

prgname=$(basename "$0")

xserver_dispno() {
    ! xset q &>/dev/null && exit 1
    dispno=$(echo "$DISPLAY" | awk -F '[:.]' '{print $2}')
    printf '%d\n' "$dispno"
}

xserver_pid() {
    dispno=$(xserver_dispno)
    lockfile="/tmp/.X$dispno-lock"

    [ ! -e "$lockfile" ] && exit 1
    cat "$lockfile" | sed 's/\s//g'
}

xserver_cmd() {
    pid=$(xserver_pid)
    ps -p "$pid" -o cmd=
}

xserver_name() {
    pid=$(xserver_pid)
    ps -p "$pid" -o comm=
}

case $1 in
    cmd)
        xserver_cmd
        ;;
    dispno)
        xserver_dispno
        ;;
    name)
        xserver_name
        ;;
    pid)
        xserver_pid
        ;;
    *)
        cat <<-EOF
		usage: $prgname cmd     - get command-line
		       $prgname dispno  - get display number
		       $prgname name    - get command name
		       $prgname pid     - get PID
		
		Get information about X server (based on DISPLAY environment variable).
		EOF
        exit 2
        ;;
esac
