#!/usr/bin/env bash

set -eu -o pipefail

prgname=${0##*/}

(( $# )) && cd -- "$1"

filter=(sed -r 's/ time=\S+//')
if [[ $prgname = dirsum0 ]]; then
    filter=(cat)
fi

bsdtar -c -f - --format mtree --options mtree:sha1 . |
    "${filter[@]}" | sha1sum | awk '{ print $1 }'
