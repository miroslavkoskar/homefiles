#!/usr/bin/env bash

set -eu

prgname=${0##*/}

if [[ $prgname == 'urls-open' ]]; then
    filter=(cat)
    case ${1-} in -r)
        filter=(tac)
        ;;
    esac

    tmpfile=$(mktemp)
    cleanup() { rm -f "$tmpfile"; }
    trap cleanup EXIT

    urls | uniq | "${filter[@]}" >"$tmpfile"
    [[ -s $tmpfile ]] || exit 1
    if hash rofi &>/dev/null; then
        rofi -dmenu -i -sync -multi-select -no-custom \
            -p "$prgname:" <"$tmpfile" | xargs -r -n1 b
    else
        dmenu -l 5 -p "$prgname" <"$tmpfile" | xargs -r -n1 b
    fi
    exit
fi

xurls -r
