#!/bin/bash

set -eu -o pipefail

low=8
med=10
high=15

toggle() {
    val=$(</sys/class/backlight/acpi_video0/brightness)
    if ((val < low)); then
        val=$low
    elif ((val < med)); then
        val=$med
    elif ((val < high)); then
        val=$high
    else
        val=$low
    fi
    # SEEALSO: xbacklight(1) - adjust backlight brightness using RandR extension
    sudo bash -c "echo $val >/sys/class/backlight/acpi_video0/brightness"
}

if [ ! -t 1 ]; then
    toggle
    exit
fi

while true; do
    printf '\e[1G%s\e[0K' "$(status backlight)"

    read -N1 -rs c
    case $c in
        q|Q)
            break
            ;;
        *)
            toggle
            ;;
    esac
done
echo
