#!/usr/bin/env bash

set -eu

export NOOSD=1

post_hook() { apod set & }

src=~/bin/xscreen.$HOSTNAME
# shellcheck disable=SC1090
[[ -e $src ]] && . "$src"

xserver=$(xserverq name)
dispno=$(xserverq dispno)

set +e

xset b off s off r rate 500 35
xrdb -load ~/.Xresources

case $xserver in
    Xorg)
        (sleep 1; exec backlight-auto) &
        xconfig=$(<"$XDG_RUNTIME_DIR/xorg/xconfig:$dispno")
        layout_hook_"$xconfig" "$@"
        xrandr --dpi 96
        xset dpms 0 0 300
        touchpad off
        trackpoint-wheel on
        ;;
    Xephyr)
        xrdb -merge - <<<'Xft.dpi: 96'
        xrandr &>/dev/null # fixes screen after resize
        ;;
esac

xkb -
numlockx on

xsetroot -cursor_name left_ptr
hsetroot || xsetroot -solid black

post_hook
true
