# vim: ft=muttrc

set my_notmuch_results = "`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`"

macro index \e<F8> "<change-folder>$my_notmuch_results<enter>" 'go to notmuch results mailbox'

macro index <F8> \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<shell-escape>notmuch-mutt -r --prompt search<enter>\
<change-folder-readonly>$my_notmuch_results<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
'notmuch: search mail'

macro index <F9> \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<pipe-message>notmuch-mutt -r thread<enter>\
<change-folder-readonly>$my_notmuch_results<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
'notmuch: reconstruct thread'

#macro index <F6> \
#"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
#<pipe-message>notmuch-mutt tag -- -inbox<enter>\
#<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
#'notmuch: remove message from inbox'

# map 'q' to '<space>' - change to selected sidebar mailbox
folder-hook "$my_notmuch_results" 'macro index q <space>'
