# vim: ft=muttrc

# global settings
set abort_nosubject = ask-no
set abort_unmodified = no
set alias_file = ~/.mutt/aliases
set bounce = ask-no
set certificate_file = ~/.mutt/certificates
set delete
set editor = 'e +/^$ ++1 +noh'
set header_cache = ~/.mutt/cache/headers
set history = 100
set history_file = ~/.mutt/history
set ispell = 'aspell -e --email-margin=0 --run-together -c'
set mail_check = 0
set mailcap_path = ~/.mutt/mailcap
set mbox_type = Maildir
set message_cachedir = ~/.mutt/cache/messages
set pipe_decode
set quit
set recall = ask-no
set reverse_alias
set save_history = 100
set sleep_time = 0
set ssl_force_tls
set ssl_starttls
set time_inc = 500
set timeout = 5
set use_envelope_from
set wrap = -1
unset confirmappend
unset header_cache_compress
unset help
unset mail_check_recent
unset mark_old
unset use_domain
unset user_agent
unset wait_key

# formats
set alias_format = ' %2n %t %-40.40r    %a'
set compose_format = "mutt-hstatus '%v' '-- Mutt: Compose [Approx. msg size: %l   Atts: %a]'|"
set date_format = '!%b %d %I:%M'
set folder_format = ' %2C %t %N %F %2l %-8.8u %-8.8g %8s %d %f'
set index_format = '%?M?+& ?[%Z]  %D  %?y?%-25.25y&%-25.25L?  %s'
set pager_format = '[%Z] (%C/%m) %n: %s%*  -- (%P)'
set query_format = ' %2c %t %-40.40a    %n %?e?(%e)?'
set status_format = "mutt-hstatus '%v' '[%r] %f (%n/%m)%?d? deleted:%d?%?t? tagged:%t?%?F? flagged:%F?%?p? postponed:%p? %l %?V?-- limit (%M): %V? %> %s/%S (%P)'|"

# index settings
set reply_regexp = '^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*'
set sort_aux = reverse-date-received
source ~/.mutt/sort_threads

# pager settings
alternative_order text/plain text/enriched text/html
auto_view text/html
set menu_scroll
set pager_context = 5
set pager_index_lines = 11
set pager_stop
set quote_regexp = '^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+'
set tilde
unset markers

# compose settings
set askcc
set attribution = 'On %d, %n wrote:'
set edit_headers
set fast_reply
set fcc_attach
set forward_format = 'Fwd: %s'
set forward_quote
set include
set mime_forward = ask-no
set realname = 'Miroslav Koskar' # overriden by name in $from, if any
set reply_to
set reverse_name
set signature = ~/.mutt/signature

# headers
hdr_order from: to: cc: list-id: list-archive: date: subject:
ignore *
unignore from: to: cc: list-id: list-archive: date: subject:

# key bindings
bind generic        *           noop
bind generic        ?           noop
bind generic        =           noop
bind generic        Z           noop
bind generic        [           noop
bind generic        ]           noop
bind generic        ?           search-reverse
bind generic        N           search-opposite
bind generic        \cF         next-page
bind generic        \cB         previous-page
bind generic        \cD         half-down
bind generic        \cU         half-up
bind generic        \e?         help
bind generic        gg          first-entry
bind generic        G           last-entry
bind generic        z           noop
bind generic        zb          current-bottom
bind generic        zz          current-middle
bind generic        zt          current-top
bind generic,pager  (           previous-entry
bind generic,pager  )           next-entry

bind index          x           noop
bind index          L           bottom-page         # generic
bind index          gg          first-entry         # generic
bind index          G           last-entry          # generic
bind index          zm          collapse-all
bind index          zr          collapse-all
bind index          zc          collapse-thread
bind index          zo          collapse-thread
bind index,pager    &           noop
bind index,pager    \#          noop
bind index,pager    o           noop
bind index,pager    O           noop
bind index,pager    ,           next-unread-mailbox
bind index,pager    I           imap-fetch-mail
bind index,pager    J           next-unread
bind index,pager    K           previous-unread
bind index,pager    N           search-opposite     # generic
bind index,pager    R           group-reply
bind index,pager    \cF         next-page           # generic
bind index,pager    \cB         previous-page       # generic
bind index,pager    \cD         half-down           # generic
bind index,pager    \cU         half-up             # generic
bind index,pager    s           sort-mailbox
bind index,pager    S           sort-reverse
bind index,pager    [           previous-subthread
bind index,pager    ]           next-subthread
bind index,pager    {           previous-thread
bind index,pager    }           next-thread

bind pager          Q           noop
bind pager          \e?         help
bind pager          gg          top
bind pager          G           bottom
bind pager          <down>      next-line
bind pager          <up>        previous-line
bind pager          j           next-line
bind pager          k           previous-line
bind pager          <return>    exit

bind alias          <tab>       exit

bind query          \cO         exit

bind attach         \cF         next-page           # generic
bind attach         \cB         previous-page       # generic
bind attach         L           bottom-page         # generic
bind attach         G           last-entry          # generic
bind attach         gg          first-entry         # generic

bind browser        o           noop
bind browser        O           noop
bind browser        N           search-opposite     # generic
bind browser        s           sort
bind browser        S           sort-reverse

bind editor         \cT         noop
bind editor         \cO         complete-query
bind editor         \cP         history-up
bind editor         \cN         history-down
bind editor         <space>     noop
bind editor         \e<space>   buffy-cycle

bind attach         o           view-attach

# macros
macro generic,index \ej )))
macro generic,index \ek (((
macro generic,pager <F1> '<shell-escape>pg /usr/share/doc/mutt/manual.txt<enter>' 'show manual'
macro index \'1 '<limit>~d \=0d<enter>' 'limit today messages'
macro index \'2 '<limit>~d \=1d<enter>' 'limit 1 day old messages'
macro index \'3 '<limit>~d \>2d<enter>' 'limit 2 days old messages'
macro index \'\' '<limit>all<enter>' 'cancel limit'
macro index,pager Z '<shell-escape>mbsync &<enter>' 'trigger mailboxes synchronization'
macro index,pager * <tag-pattern>~A<enter> 'tag all'
macro index,pager 0 <tag-pattern>~N<enter> 'tag new'
macro index,pager \c? <untag-pattern>~A<enter> 'untag all'
macro index,pager w <tag-prefix><set-flag> 'set a status flag on all tagged messages'
macro index,pager W <tag-prefix><clear-flag> 'clear a status flag on all tagged messages'
macro index,pager - <tag-prefix><clear-flag>N 'mark all tagged messages as read'
macro index,pager \ea '<change-folder>!!<enter>' 'go to previous mailbox'
macro index,pager y <change-folder>?<toggle-mailboxes> 'show mailboxes list'
macro index,pager,attach O <pipe-message>w3m<enter> 'view in w3m'
macro index,pager,attach \cO '<pipe-message>stdiner -T b0<enter>' 'view in browser'
macro pager \ej jjjjj
macro pager \ek kkkkk
macro browser \ea <exit>\ea 'go to previous mailbox'
macro browser u /^\\.\\.$<enter><enter> 'go up a dir'
macro compose Y pfy 'send the message without PGP'
macro compose v '<edit-from>^Uidentity_<tab>' 'select from'

macro index o <enter>
macro pager o q

macro index \c_ <tag-prefix><save-message> 'save messages'
macro pager \c_ <save-message> 'save message'

# sidebar patch
set sidebar_delim = ' '
set sidebar_folderindent
set sidebar_format = '%B%?F? [%F]?%* %?N?%N?%C'
set sidebar_shortpath
set sidebar_visible
set sidebar_width = 20
bind index,pager <space> sidebar-open
macro index,pager \en <sidebar-next> 'sidebar-next'
macro index,pager \ep <sidebar-prev> 'sidebar-prev'
macro index,pager \cN <sidebar-next><sidebar-open> 'sidebar-next & sidebar-open'
macro index,pager \cP <sidebar-prev><sidebar-open> 'sidebar-prev & sidebar-open'
macro index,pager ~ '<enter-command>toggle sidebar_visible<enter>' 'toggle sidebar'

# global includes
source $alias_file
source ~/.mutt/colors
source ~/.mutt/gpg
source ~/.mutt/accountsrc

# trigger mailboxes synchronization
push Z
